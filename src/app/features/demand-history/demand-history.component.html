<section class="demand-history-section">
  <!-- <header class="section-header">
    <h1 class="section-title">Historique des demandes</h1>
    <p class="section-subtitle">
      Retrouvez ici tous les dossiers clients et accédez au traitement détaillé
      de chaque demande.
    </p>
  </header> -->

  <div class="demand-history-wrapper">
    <div class="table-card">
      <div class="table-header-inline">
        <!-- <div>
          <h2 class="table-header-title">Suivi des dossiers clients</h2>
          <p class="table-header-description">
            Vue consolidée du statut des dossiers et des documents transmis.
          </p>
        </div> -->
      </div>

      <div class="table-scroll-wrapper">
        <p-table [value]="dossiers" class="monday-table">
          <ng-template pTemplate="header">
            <tr>
              <th class="col-expander"></th>
              <th class="col-checkbox">
                <div class="checkbox-wrapper">
                  <input
                    type="checkbox"
                    class="custom-checkbox"
                    [checked]="areAllSelected()"
                    (change)="toggleSelectAll($event)"
                  />
                </div>
              </th>
              <th>Client</th>
              <th>Statut du dossier</th>
              <th>Documents</th>
              <th>Modifier à</th>
              <th class="col-action">Action</th>
            </tr>
          </ng-template>

          <ng-template pTemplate="body" let-dossier>
            <tr
              class="main-row"
              [ngClass]="{ 'is-expanded': isExpanded(dossier) }"
            >
              <td class="col-expander">
                <button
                  type="button"
                  class="expander-btn"
                  [ngClass]="{ 'is-open': isExpanded(dossier) }"
                  (click)="toggleExpand(dossier)"
                >
                  <i class="pi pi-chevron-right"></i>
                </button>
              </td>

              <td class="col-checkbox">
                <div class="checkbox-wrapper">
                  <input
                    type="checkbox"
                    class="custom-checkbox"
                    [(ngModel)]="dossier.selected"
                  />
                </div>
              </td>

              <td class="col-client">
                <div class="owner-cell">
                  <div class="owner-avatar">
                    {{ getInitials(dossier.fullName) }}
                  </div>
                  <span class="owner-name">
                    {{ dossier.fullName }}
                  </span>
                </div>
              </td>

              <td class="col-status">
                <div
                  class="status-pill"
                  [ngClass]="'status-' + dossier.statusKey"
                >
                  {{ dossier.statusLabel }}
                </div>
              </td>

              <td class="col-docs">
                {{ dossier.docsSummary }}
              </td>

              <td class="col-date">
                {{ dossier.lastUpdatedAt }}
              </td>

              <td class="col-action">
                <button
                  type="button"
                  class="action-button"
                  (click)="onTreatDossier(dossier)"
                >
                  <i class="pi pi-play-circle"></i>
                  Traiter le dossier
                </button>
              </td>
            </tr>

            <tr *ngIf="isExpanded(dossier)" class="subitems-row">
              <td colspan="7" class="subitems-container">
                <div class="subitems-wrapper">
                  <table class="sub-table">
                    <thead>
                      <tr>
                        <th>Type de document</th>
                        <th>Nom du fichier</th>
                        <th>Statut</th>
                        <th>Téléversé le</th>
                        <th>Dernière mise à jour</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr *ngFor="let doc of dossier.documents">
                        <td>
                          <span class="type-chip">
                            {{ doc.typeLabel }}
                          </span>
                        </td>
                        <td>{{ doc.fileName }}</td>
                        <td>
                          <div
                            class="status-pill sm"
                            [ngClass]="'status-' + doc.statusKey"
                          >
                            {{ doc.statusLabel }}
                          </div>
                        </td>
                        <td>{{ doc.uploadedAt }}</td>
                        <td>{{ doc.lastUpdatedAt }}</td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </td>
            </tr>
          </ng-template>
        </p-table>
      </div>
    </div>
  </div>
</section>
